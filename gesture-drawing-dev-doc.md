# é¡”ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒ‰ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°å­¦ç¿’ãƒ„ãƒ¼ãƒ« - é–‹ç™ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

æ®µéšçš„ãªå­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—ã§é¡”ã®æç”»ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ã®æç”»ã‚’å‚è€ƒã«ã—ãªãŒã‚‰ã€å¾ã€…ã«è©³ç´°åº¦ã‚’ä¸Šã’ã¦ã„ãå­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã€‚

### ä¸»è¦æ©Ÿèƒ½
- 4æ®µéšã®å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆãƒ™ãƒ¼ã‚¹å½¢ â†’ ãƒ‘ãƒ¼ãƒ„è¿½åŠ  â†’ è‡ªåŠ›æç”» â†’ è©³ç´°ä»•ä¸Šã’ï¼‰
- Canvasæç”»æ©Ÿèƒ½ï¼ˆãƒ–ãƒ©ã‚·ã€æ¶ˆã—ã‚´ãƒ ã€Undo/Redoï¼‰
- ç­”ãˆåˆã‚ã›æ©Ÿèƒ½ï¼ˆåŠé€æ˜ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰
- æç”»ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
- é€²æ—ç®¡ç†ã¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼è¡¨ç¤º
- è¤‡æ•°ã®é¡”å†™çœŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

---

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **React 18+** (Vite)
- **TypeScript**
- **Tailwind CSS**
- **Zustand** (çŠ¶æ…‹ç®¡ç†)
- **React Router** (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- **Fabric.js** ã¾ãŸã¯ **Konva.js** (Canvasæç”»)
- **Lucide React** (ã‚¢ã‚¤ã‚³ãƒ³)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Node.js + Express**
- **PostgreSQL** (ãƒ¡ã‚¤ãƒ³DB)
- **Prisma** (ORM)
- **AWS S3** ã¾ãŸã¯ **Cloudinary** (ç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
- **JWT** (èªè¨¼)

### ç”»åƒå‡¦ç†
- **Python 3.10+**
- **OpenCV** (é¡”æ¤œå‡ºãƒ»åˆ‡ã‚ŠæŠœã)
- **PIL/Pillow** (ç”»åƒå‡¦ç†)
- **FastAPI** (ç”»åƒå‡¦ç†API)

### ã‚¤ãƒ³ãƒ•ãƒ©
- **Docker** (é–‹ç™ºç’°å¢ƒ)
- **Vercel** ã¾ãŸã¯ **Netlify** (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
- **Railway** ã¾ãŸã¯ **Render** (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰)

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
gesture-drawing-app/
â”œâ”€â”€ frontend/                    # React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Canvas/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DrawingCanvas.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CanvasToolbar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ OverlayController.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Gallery/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DrawingGallery.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ProgressChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Photos/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PhotoDisplay.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PhotoSelector.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MainLayout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Common/
â”‚   â”‚   â”‚       â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚       â”œâ”€â”€ Modal.tsx
â”‚   â”‚   â”‚       â””â”€â”€ Loader.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Practice.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Gallery.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useCanvas.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useDrawing.ts
â”‚   â”‚   â”‚   â””â”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â”œâ”€â”€ drawingStore.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ photoStore.ts
â”‚   â”‚   â”‚   â””â”€â”€ userStore.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.ts
â”‚   â”‚   â”‚   â””â”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ canvas.ts
â”‚   â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â””â”€â”€ main.tsx
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ backend/                     # Express ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ drawingController.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ photoController.ts
â”‚   â”‚   â”‚   â””â”€â”€ userController.ts
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ drawings.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ photos.ts
â”‚   â”‚   â”‚   â””â”€â”€ users.ts
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ errorHandler.ts
â”‚   â”‚   â”‚   â””â”€â”€ validation.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ drawingService.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ photoService.ts
â”‚   â”‚   â”‚   â””â”€â”€ storageService.ts
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts
â”‚   â”‚   â”‚   â””â”€â”€ env.ts
â”‚   â”‚   â””â”€â”€ server.ts
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”‚   â””â”€â”€ migrations/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ image-processor/             # Python ç”»åƒå‡¦ç†
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ fetch_photos.py
â”‚   â”‚   â”œâ”€â”€ crop_faces.py
â”‚   â”‚   â””â”€â”€ batch_process.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ main.py              # FastAPI
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ face_detector.py
â”‚   â”‚   â””â”€â”€ image_utils.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ README.md
```

---

## ğŸ¯ å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—è©³ç´°

### Step 1: é¡”ã®ãƒ™ãƒ¼ã‚¹å½¢
- **ç›®çš„**: é¡”ã®åŸå½¢ç†è§£
- **æç”»å†…å®¹**: å††å½¢(â—‹)ã¾ãŸã¯å››è§’å½¢(â–¡)
- **æç”»æ–¹æ³•**: å‚è€ƒå†™çœŸã®ä¸Šã«åŠé€æ˜ã§æã
- **è©•ä¾¡åŸºæº–**: é¡”ã®è¼ªéƒ­ãŒãƒ™ãƒ¼ã‚¹å½¢ã«åã¾ã£ã¦ã„ã‚‹ã‹

### Step 2: ãƒ™ãƒ¼ã‚¹ + ä¸»è¦ãƒ‘ãƒ¼ãƒ„
- **ç›®çš„**: ãƒ‘ãƒ¼ãƒ„ã®ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦š
- **æç”»å†…å®¹**: ãƒ™ãƒ¼ã‚¹å½¢ + ç›®ãƒ»é¼»ãƒ»å£ãƒ»è€³ï¼ˆå¤§ã¾ã‹ï¼‰
- **æç”»æ–¹æ³•**: å‚è€ƒå†™çœŸã®ä¸Šã«æã
- **è©•ä¾¡åŸºæº–**: ãƒ‘ãƒ¼ãƒ„ã®ä½ç½®é–¢ä¿‚ãŒæ­£ç¢ºã‹

### Step 3: è‡ªåŠ›ã§ãƒãƒ©ãƒ³ã‚¹ç¢ºèª
- **ç›®çš„**: è¨˜æ†¶ã¨è¦³å¯ŸåŠ›ã®å‘ä¸Š
- **æç”»å†…å®¹**: ãƒ™ãƒ¼ã‚¹ + ãƒ‘ãƒ¼ãƒ„ï¼ˆå¤§ã¾ã‹ï¼‰
- **æç”»æ–¹æ³•**: å†™çœŸã®éš£ã‚¹ãƒšãƒ¼ã‚¹ã«è‡ªåŠ›ã§æã
- **è©•ä¾¡åŸºæº–**: Step2ã®æç”»ã¨æ¯”è¼ƒã—ã¦ç²¾åº¦ãƒã‚§ãƒƒã‚¯

### Step 4: è©³ç´°ä»•ä¸Šã’
- **ç›®çš„**: ãƒ‡ãƒƒã‚µãƒ³å…¨ä½“ã®å®Œæˆåº¦
- **æç”»å†…å®¹**: ãƒ™ãƒ¼ã‚¹ + ãƒ‘ãƒ¼ãƒ„ + é«ªå‹ãƒ»çœ‰æ¯›ãƒ»å½±ãªã©
- **æç”»æ–¹æ³•**: Step3åŒæ§˜ã«è‡ªåŠ›ã§æã
- **è©•ä¾¡åŸºæº–**: å®Œæˆåº¦ã¨è¡¨ç¾åŠ›

---

## ğŸ—„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Prisma Schema

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  drawings  Drawing[]
  progress  Progress[]
}

model Photo {
  id          String   @id @default(uuid())
  fileName    String   @unique
  storageUrl  String
  thumbnailUrl String?
  source      String?  // "unsplash", "generated", "custom"
  metadata    Json?    // ç”»åƒã‚µã‚¤ã‚ºã€ã‚¿ã‚°ãªã©
  createdAt   DateTime @default(now())
  
  drawings    Drawing[]
}

model Drawing {
  id          String   @id @default(uuid())
  userId      String
  photoId     String
  step        Int      // 1, 2, 3, 4
  canvasData  Json     // Fabric.js ã¾ãŸã¯ Konva.js ã®JSON
  imageUrl    String?  // ä¿å­˜ã•ã‚ŒãŸç”»åƒURL
  timeSpent   Int?     // ç§’å˜ä½
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  user        User     @relation(fields: [userId], references: [id])
  photo       Photo    @relation(fields: [photoId], references: [id])
  
  @@index([userId, photoId, step])
}

model Progress {
  id              String   @id @default(uuid())
  userId          String
  totalDrawings   Int      @default(0)
  completedPhotos Int      @default(0)
  currentStreak   Int      @default(0)
  longestStreak   Int      @default(0)
  lastPracticeAt  DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  user            User     @relation(fields: [userId], references: [id])
  
  @@unique([userId])
}
```

---

## ğŸ”Œ APIè¨­è¨ˆ

### RESTful Endpoints

#### èªè¨¼
```
POST   /api/auth/register          # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
POST   /api/auth/login             # ãƒ­ã‚°ã‚¤ãƒ³
POST   /api/auth/logout            # ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
GET    /api/auth/me                # ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
```

#### å†™çœŸ
```
GET    /api/photos                 # å†™çœŸä¸€è¦§
GET    /api/photos/:id             # å†™çœŸè©³ç´°
GET    /api/photos/random          # ãƒ©ãƒ³ãƒ€ãƒ ã«å†™çœŸå–å¾—
POST   /api/photos                 # å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆç®¡ç†è€…ï¼‰
```

#### æç”»
```
GET    /api/drawings               # è‡ªåˆ†ã®æç”»ä¸€è¦§
GET    /api/drawings/:id           # æç”»è©³ç´°
POST   /api/drawings               # æç”»ä¿å­˜
PUT    /api/drawings/:id           # æç”»æ›´æ–°
DELETE /api/drawings/:id           # æç”»å‰Šé™¤
GET    /api/drawings/photo/:photoId # ç‰¹å®šå†™çœŸã®å…¨ã‚¹ãƒ†ãƒƒãƒ—å–å¾—
```

#### é€²æ—
```
GET    /api/progress               # é€²æ—æƒ…å ±å–å¾—
GET    /api/progress/stats         # çµ±è¨ˆæƒ…å ±
POST   /api/progress/complete      # ç·´ç¿’å®Œäº†è¨˜éŒ²
```

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

#### POST /api/drawings
```json
// Request
{
  "photoId": "photo-uuid",
  "step": 2,
  "canvasData": {
    "version": "5.3.0",
    "objects": [...]
  },
  "timeSpent": 300
}

// Response
{
  "id": "drawing-uuid",
  "photoId": "photo-uuid",
  "step": 2,
  "imageUrl": "https://storage.../drawing.png",
  "createdAt": "2025-10-15T12:00:00Z"
}
```

#### GET /api/photos/random
```json
// Response
{
  "id": "photo-uuid",
  "fileName": "face_001.jpg",
  "storageUrl": "https://storage.../face_001.jpg",
  "thumbnailUrl": "https://storage.../face_001_thumb.jpg"
}
```

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. DrawingCanvas.tsx
```typescript
import { useEffect, useRef, useState } from 'react';
import { fabric } from 'fabric';

interface DrawingCanvasProps {
  photoUrl: string;
  step: number;
  showOverlay: boolean;
  overlayOpacity: number;
  onSave: (canvasData: any) => void;
}

export const DrawingCanvas: React.FC<DrawingCanvasProps> = ({
  photoUrl,
  step,
  showOverlay,
  overlayOpacity,
  onSave
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [fabricCanvas, setFabricCanvas] = useState<fabric.Canvas | null>(null);

  useEffect(() => {
    if (canvasRef.current) {
      const canvas = new fabric.Canvas(canvasRef.current, {
        width: 600,
        height: 800,
        isDrawingMode: true
      });
      
      canvas.freeDrawingBrush.width = 3;
      canvas.freeDrawingBrush.color = '#000000';
      
      setFabricCanvas(canvas);
      
      return () => {
        canvas.dispose();
      };
    }
  }, []);

  const handleSave = () => {
    if (fabricCanvas) {
      const json = fabricCanvas.toJSON();
      onSave(json);
    }
  };

  return (
    <div className="relative">
      <canvas ref={canvasRef} />
      {showOverlay && (
        <img
          src={photoUrl}
          alt="overlay"
          className="absolute top-0 left-0 pointer-events-none"
          style={{ opacity: overlayOpacity }}
        />
      )}
    </div>
  );
};
```

#### 2. Zustand Store (drawingStore.ts)
```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface DrawingState {
  currentPhotoId: string | null;
  currentStep: number;
  drawings: Map<string, any>; // photoId_step -> canvasData
  
  setCurrentPhoto: (photoId: string) => void;
  setCurrentStep: (step: number) => void;
  saveDrawing: (photoId: string, step: number, data: any) => void;
  getDrawing: (photoId: string, step: number) => any;
}

export const useDrawingStore = create<DrawingState>()(
  persist(
    (set, get) => ({
      currentPhotoId: null,
      currentStep: 1,
      drawings: new Map(),

      setCurrentPhoto: (photoId) => set({ currentPhotoId: photoId }),
      
      setCurrentStep: (step) => set({ currentStep: step }),
      
      saveDrawing: (photoId, step, data) => {
        const key = `${photoId}_${step}`;
        const newDrawings = new Map(get().drawings);
        newDrawings.set(key, data);
        set({ drawings: newDrawings });
      },
      
      getDrawing: (photoId, step) => {
        const key = `${photoId}_${step}`;
        return get().drawings.get(key);
      }
    }),
    {
      name: 'drawing-storage'
    }
  )
);
```

---

## ğŸ Pythonç”»åƒå‡¦ç†

### é¡”å†™çœŸåé›†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### fetch_photos.py
```python
import requests
import os
from dotenv import load_dotenv

load_dotenv()

UNSPLASH_ACCESS_KEY = os.getenv('UNSPLASH_ACCESS_KEY')
OUTPUT_DIR = './raw_photos'

def fetch_unsplash_photos(count=50):
    """Unsplash APIã‹ã‚‰é¡”å†™çœŸã‚’å–å¾—"""
    url = "https://api.unsplash.com/photos/random"
    
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    
    for i in range(count):
        params = {
            'query': 'portrait face headshot',
            'orientation': 'portrait',
            'client_id': UNSPLASH_ACCESS_KEY
        }
        
        response = requests.get(url, params=params)
        if response.status_code == 200:
            data = response.json()
            image_url = data['urls']['regular']
            
            # ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            img_response = requests.get(image_url)
            filename = f"{OUTPUT_DIR}/unsplash_{i+1:03d}.jpg"
            
            with open(filename, 'wb') as f:
                f.write(img_response.content)
            
            print(f"Downloaded: {filename}")
        else:
            print(f"Error fetching image {i+1}")

if __name__ == "__main__":
    fetch_unsplash_photos(100)
```

#### crop_faces.py
```python
import cv2
import os
from pathlib import Path

INPUT_DIR = './raw_photos'
OUTPUT_DIR = './processed_photos'

def crop_face(image_path, output_path):
    """é¡”éƒ¨åˆ†ã‚’æ¤œå‡ºã—ã¦åˆ‡ã‚ŠæŠœã"""
    
    # Haar Cascadeåˆ†é¡å™¨ã®èª­ã¿è¾¼ã¿
    face_cascade = cv2.CascadeClassifier(
        cv2.data.haarcascades + 'haarcascade_frontalface_default.xml'
    )
    
    # ç”»åƒèª­ã¿è¾¼ã¿
    img = cv2.imread(str(image_path))
    if img is None:
        print(f"Failed to load: {image_path}")
        return False
    
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    
    # é¡”æ¤œå‡º
    faces = face_cascade.detectMultiScale(
        gray,
        scaleFactor=1.1,
        minNeighbors=5,
        minSize=(100, 100)
    )
    
    if len(faces) == 0:
        print(f"No face detected: {image_path}")
        return False
    
    # æœ€å¤§ã®é¡”ã‚’é¸æŠ
    (x, y, w, h) = max(faces, key=lambda f: f[2] * f[3])
    
    # ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ ï¼ˆé¡”ã®30%ï¼‰
    margin = int(w * 0.3)
    x1 = max(0, x - margin)
    y1 = max(0, y - margin)
    x2 = min(img.shape[1], x + w + margin)
    y2 = min(img.shape[0], y + h + margin)
    
    # åˆ‡ã‚ŠæŠœã
    face_img = img[y1:y2, x1:x2]
    
    # æ¨™æº–ã‚µã‚¤ã‚ºã«ãƒªã‚µã‚¤ã‚ºï¼ˆ600x800ï¼‰
    face_img = cv2.resize(face_img, (600, 800))
    
    # ä¿å­˜
    cv2.imwrite(str(output_path), face_img)
    print(f"Processed: {output_path}")
    return True

def batch_process():
    """ä¸€æ‹¬å‡¦ç†"""
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    
    input_path = Path(INPUT_DIR)
    success_count = 0
    
    for i, img_file in enumerate(sorted(input_path.glob('*.jpg')), 1):
        output_file = Path(OUTPUT_DIR) / f"face_{i:03d}.jpg"
        if crop_face(img_file, output_file):
            success_count += 1
    
    print(f"\nProcessed: {success_count} images")

if __name__ == "__main__":
    batch_process()
```

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
```bash
mkdir gesture-drawing-app
cd gesture-drawing-app
git init
```

### 2. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰åˆæœŸåŒ–
```bash
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install
npm install -D tailwindcss postcss autoprefixer
npm install zustand fabric lucide-react react-router-dom
npx tailwindcss init -p
```

### 3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰åˆæœŸåŒ–
```bash
mkdir backend
cd backend
npm init -y
npm install express prisma @prisma/client
npm install -D typescript @types/node @types/express tsx
npm install dotenv cors jsonwebtoken bcrypt
npm install -D @types/cors @types/jsonwebtoken @types/bcrypt

npx prisma init
```

### 4. Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
mkdir image-processor
cd image-processor
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

pip install opencv-python pillow requests python-dotenv
pip install fastapi uvicorn
```

### 5. ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# .env
DATABASE_URL="postgresql://user:password@localhost:5432/gesture_drawing"
JWT_SECRET="your-secret-key"
AWS_ACCESS_KEY_ID="your-aws-key"
AWS_SECRET_ACCESS_KEY="your-aws-secret"
S3_BUCKET_NAME="gesture-drawing-photos"
UNSPLASH_ACCESS_KEY="your-unsplash-key"
```

---

## ğŸ“ å®Ÿè£…é †åº

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ1-2é€±é–“ï¼‰
1. âœ… Prismaã‚¹ã‚­ãƒ¼ãƒä½œæˆã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
2. âœ… åŸºæœ¬çš„ãªExpressã‚µãƒ¼ãƒãƒ¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆJWTï¼‰
4. âœ… Reactãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
5. âœ… Tailwind CSSè¨­å®š

### Phase 2: Canvasæç”»æ©Ÿèƒ½ï¼ˆ1é€±é–“ï¼‰
1. âœ… Fabric.jsçµ±åˆ
2. âœ… æç”»ãƒ„ãƒ¼ãƒ«å®Ÿè£…ï¼ˆãƒ–ãƒ©ã‚·ã€æ¶ˆã—ã‚´ãƒ ã€è‰²é¸æŠï¼‰
3. âœ… Undo/Redoæ©Ÿèƒ½
4. âœ… Canvasä¿å­˜ãƒ»èª­ã¿è¾¼ã¿

### Phase 3: å†™çœŸç®¡ç†ï¼ˆ1é€±é–“ï¼‰
1. âœ… Pythonç”»åƒå‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
2. âœ… é¡”å†™çœŸã®åé›†ã¨å‰å‡¦ç†
3. âœ… S3/Cloudinaryã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. âœ… å†™çœŸAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
5. âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å†™çœŸè¡¨ç¤º

### Phase 4: å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ1-2é€±é–“ï¼‰
1. âœ… ã‚¹ãƒ†ãƒƒãƒ—ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯
2. âœ… ç­”ãˆåˆã‚ã›ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ©Ÿèƒ½
3. âœ… æç”»ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜API
4. âœ… å‰ã‚¹ãƒ†ãƒƒãƒ—æç”»ã®å–å¾—ã¨è¡¨ç¤º
5. âœ… ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½

### Phase 5: é€²æ—ç®¡ç†ã¨ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼ˆ1é€±é–“ï¼‰
1. âœ… é€²æ—ãƒ‡ãƒ¼ã‚¿ã®è¨˜éŒ²
2. âœ… ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒšãƒ¼ã‚¸
3. âœ… çµ±è¨ˆã‚°ãƒ©ãƒ•ï¼ˆChart.js / Rechartsï¼‰
4. âœ… é€£ç¶šç·´ç¿’æ—¥æ•°ã‚«ã‚¦ãƒ³ãƒˆ

### Phase 6: æ”¹å–„ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ1é€±é–“ï¼‰
1. âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
2. âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
3. âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
4. âœ… ãƒ†ã‚¹ãƒˆè¿½åŠ 
5. âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆVercel + Railwayï¼‰

---

## ğŸ¨ UI/UXæ”¹å–„ã‚¢ã‚¤ãƒ‡ã‚¢

### å³åº§ã«å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½
- â±ï¸ **ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½**: 1åˆ†ã€5åˆ†ã€10åˆ†ã®åˆ¶é™æ™‚é–“
- ğŸ¯ **ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º**: æ¯”ç‡ç¢ºèªç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚°ãƒªãƒƒãƒ‰
- ğŸ¨ **ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ**: ã‚ˆãä½¿ã†è‰²ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ
- ğŸ“± **ã‚¿ãƒƒãƒå¯¾å¿œ**: iPad/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã®æç”»
- âŒ¨ï¸ **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ**: Ctrl+Zï¼ˆUndoï¼‰ã€Ctrl+Sï¼ˆä¿å­˜ï¼‰ãªã©

### å°†æ¥çš„ãªæ‹¡å¼µ
- ğŸ¤– **AIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: é¡”ã®æ¯”ç‡ãƒã‚§ãƒƒã‚¯
- ğŸ‘¥ **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½**: ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æç”»é–²è¦§
- ğŸ† **ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¢ãƒ¼ãƒ‰**: æ—¥æ›¿ã‚ã‚Šèª²é¡Œ
- ğŸ“Š **è©³ç´°åˆ†æ**: æç”»æ™‚é–“ã®åˆ†æã€æ”¹å–„ç‚¹ã®ææ¡ˆ
- ğŸ¬ **ãƒ—ãƒ­ã‚»ã‚¹éŒ²ç”»**: æç”»éç¨‹ã®å†ç”Ÿæ©Ÿèƒ½

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Jest + React Testing Library**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- **Cypress**: E2Eãƒ†ã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- **Jest + Supertest**: APIãƒ†ã‚¹ãƒˆ
- **Prisma Studio**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª

### ç”»åƒå‡¦ç†
- **pytest**: Pythoné–¢æ•°ãƒ†ã‚¹ãƒˆ

---

## ğŸ“¦ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vercel)
```bash
cd frontend
vercel --prod
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Railway)
```bash
railway login
railway init
railway up
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (Supabase / Railway)
- PostgreSQLã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨
- è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **èªè¨¼**: JWTãƒˆãƒ¼ã‚¯ãƒ³ã®HTTPOnly Cookieä¿å­˜
2. **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã¨ã‚µã‚¤ã‚ºã®æ¤œè¨¼
3. **Rate Limiting**: APIå‘¼ã³å‡ºã—åˆ¶é™
4. **CORSè¨­å®š**: è¨±å¯ã•ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³ã®ã¿
5. **ç’°å¢ƒå¤‰æ•°**: æ©Ÿå¯†æƒ…å ±ã®é©åˆ‡ãªç®¡ç†

---

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Fabric.js Documentation](http://fabricjs.com/docs/)
- [Prisma Documentation](https://www.prisma.io/docs)
- [OpenCV Face Detection](https://docs.opencv.org/4.x/db/d28/tutorial_cascade_classifier.html)
- [Unsplash API](https://unsplash.com/documentation)
- [Zustand Documentation](https://zustand-demo.pmnd.rs/)

---

## ğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. Claude Codeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
2. `frontend/` ã¨ `backend/` ã®åˆæœŸåŒ–
3. Prismaã‚¹ã‚­ãƒ¼ãƒã®å®Ÿè£…
4. åŸºæœ¬çš„ãªCanvasæç”»æ©Ÿèƒ½ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ä½œæˆ

Claude Codeã§ã€Œã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«åŸºã¥ã„ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€ã¨æŒ‡ç¤ºã™ã‚Œã°ã€æ®µéšçš„ã«å®Ÿè£…ã§ãã¾ã™ï¼